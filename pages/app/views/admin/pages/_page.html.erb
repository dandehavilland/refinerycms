<li class='clearfix record' id="<%= dom_id(page) -%>">
  <% cache page.cache_key, :expires_in => 10.days do %>
    <div class='clearfix'>
      <span class='title'>
        <%= page.title_with_meta.html_safe %>
        <% if is_localised? page %>
          <span class='preview'>
            <% locale_info_for(page).each_pair do |locale, has_title| %>
              <%= link_to refinery_icon_tag("flags/#{locale}.png", :size => '16x11'),
                          edit_admin_page_path(page, :switch_locale => locale, :scope => page.parent_id),
                          :class => "locale #{"missing_locale" unless has_title}" %>
            <% end %>
          </span>
        <% end %>
      </span>

      <span class='actions'>
        <%= link_to refinery_icon_tag('application_go.png'), page.url,
                    :target => "_blank",
                    :link => page.url.inspect,
                    :title => t('.view_live_html') %>
        <%= link_to refinery_icon_tag('application_edit.png'), edit_admin_page_path(page, :scope => page.parent_id, :switch_locale => Thread.current[:globalize_locale]),
                    :title => t('edit', :scope => 'admin.pages') %>
        <%= link_to refinery_icon_tag('delete.png'), admin_page_path(page, :scope => page.parent_id),
                    :class => "cancel confirm-delete",
                    :title => t('delete', :scope => 'admin.pages'),
                    :confirm => t('message', :scope => 'shared.admin.delete', :title => page.title_with_meta.gsub(/\ ?<em>.*<\/em>/, "")),
                    :method => :delete if page.deletable? %>
      </span>
    </div>
  <% end # cache %>
  <ul class='nested'>
    <%= render :partial => 'page', :collection => page.children.sort {|a,b| a.lft <=> b.lft } %>
  </ul>
</li>