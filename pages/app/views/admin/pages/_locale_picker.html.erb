<input type='hidden' name='switch_locale' id='switch_locale' value='<%= local_assigns[:current_locale] %>' />
<% if (locales ||= ::Refinery::I18n.frontend_locales).present? and locales.many? %>
  <ul id='switch_locale_picker' class='clearfix'>
    <% locales.each do |locale| 
      li_klass = %w{}
      klass = %w{locale}
      
      if @page.present?
        translation = @page.translations.where(:locale => locale).first
        klass << "missing_locale" unless translation.present? && translation.try(:title)
      end
      
      if locale.to_s == local_assigns[:current_locale].to_s
        li_klass << "selected"
      end
      %>
      <li class="<%=li_klass.join(" ")%>">
        <%= link_to refinery_icon_tag("flags/#{locale}.png", :size => '16x11'),
                    url_for(:switch_locale => locale, :scope => @page.present? ? @page.parent_id : nil),
                    :class => klass.join(" ")
                    %>
      </li>
    <% end %>
  </ul>
<% end %>
